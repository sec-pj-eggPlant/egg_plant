<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>가지 : 회원가입</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/global.css" />
    <link rel="stylesheet" href="/css/signup.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
  <div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="row signup-box">
      <div class="col-6 d-flex justify-content-center align-items-center px-5">
        <img src="/images/logo.svg" alt="logo" class="w-100" />
      </div>
      <div class="col-6 px-5">
        <h2 class="mb-5">회원가입</h2>
        <form action="/member/signup" method="post" id="signupForm">
          <div class="mb-3">
            <label class="form-label fw-bold">회원 유형</label>
            <select name="role" class="form-select" id="role" required>
              <option value="">유형 선택</option>
              <option value="ROLE_OWNER">임차인</option>
              <option value="ROLE_RENTER">임대인</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">아이디</label>
            <input type="text" class="form-control" id="userID" name="userID" required />
            <div id="userIDCheckMsg" class="text-danger mt-1"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">비밀번호</label>
            <input type="password" class="form-control" id="userPW" name="userPW" required />
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">비밀번호 확인</label>
            <input type="password" class="form-control" id="userPWCheck" name="userPWCheck" required />
            <div id="pwCheckMsg" class="text-danger mt-1"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">이메일</label>
            <div class="d-flex gap-2">
              <input type="text" class="form-control" id="email1" required />
              <span class="align-self-center">@</span>
              <select class="form-select" id="email2" required>
                <option value="">선택</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="hanmail.net">hanmail.net</option>
                <option value="custom">직접 입력</option>
              </select>
              <input type="text" class="form-control d-none" id="emailCustom" placeholder="다른 도메인" />
            </div>
            <input type="hidden" name="userEmail" id="userEmail" />
            <div id="userEmailCheckMsg" class="text-danger mt-1"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">이름</label>
            <input type="text" class="form-control" id="userName" name="userName" required />
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">닉네임</label>
            <input type="text" class="form-control" id="nickName" name="nickName" required />
            <div id="nickNameCheckMsg" class="text-danger mt-1"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">전화번호</label>
            <div class="d-flex gap-2">
              <select class="form-select w-25" id="tel1" required>
                <option value="">선택</option>
                <option value="010">010</option>
                <option value="011">011</option>
              </select>
              <span class="align-self-center">-</span>
              <input type="text" class="form-control w-25" id="tel2" maxlength="4" required />
              <span class="align-self-center">-</span>
              <input type="text" class="form-control w-25" id="tel3" maxlength="4" required />
            </div>
            <input type="hidden" name="tel" id="tel" />
            <div id="telCheckMsg" class="text-danger mt-1"></div>
          </div>

          <button type="submit" class="btn btn-primary w-100" id="signupBtn" disabled>회원가입</button>
        </form>
      </div>
    </div>
  </div>
    <footer>
      <div class="container">
        <div class="row pt-5">
          <div class="col-7">
            <ul class="d-flex gap-3">
              <li><a href="">이용약관</a></li>
              <li><a href="">개인정보처리방침</a></li>
              <li><a href="">위치기반서비스</a></li>
              <li><a href="">이용약관</a></li>
              <li><a href="">이메일 무단수집거부</a></li>
              <li><a href="">법적고지</a></li>
              <li><a href="">사업자정보</a></li>
            </ul>
          </div>
          <div class="col-5">
            <p>
              대표이사 : 이몽룡 | 개인정보보호책임자 : 임춘향 | 사업자등록번호 :
              8282-82-828282
            </p>
            <p>
              통신판매업종신고 : 제 2025-서울강남구-8282 | 대표이메일 :
              gagi@gagi.store
            </p>
            <p>
              copyright ⓒ 2021. 가지 : 가장가까운지역창고 Co., Ltd. All rights
              reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
<script>
  document.querySelector("#userID").addEventListener("input", function() {
    const userID = this.value;
    if (userID.length < 3) {
      document.querySelector("#userIDCheckMsg").textContent = "3글자 이상 적어주세요";
      return;
    }

    fetch(`/member/checkUserID?userID=${encodeURIComponent(userID)}`)
            .then(res => res.json())
            .then(exists => {
              if (exists) {
                document.querySelector("#userIDCheckMsg").textContent = "이미 사용중인 아이디입니다.";
              } else {
                document.querySelector("#userIDCheckMsg").textContent = "";
              }
            })
            .catch(error => {
              console.error(error);
              document.querySelector("#userIDCheckMsg").textContent = "확인 중 오류 발생";
            });
  });

  document.querySelector("#nickName").addEventListener("input", function() {
    const nickName = this.value;
    if (nickName.length < 2) {
      document.querySelector("#nickNameCheckMsg").textContent = "2글자 이상 적어주세요";
      return;
    }

    fetch(`/member/checkUserNickname?nickName=${encodeURIComponent(nickName)}`)
            .then(res => res.json())
            .then(exists => {
              if (exists) {
                document.querySelector("#nickNameCheckMsg").textContent = "이미 사용중인 닉네임입니다.";
              } else {
                document.querySelector("#nickNameCheckMsg").textContent = "";
              }
            })
            .catch(error => {
              console.error(error);
              document.querySelector("#nickNameCheckMsg").textContent = "확인 중 오류 발생";
            });
  });

  document.querySelector("#userEmail").addEventListener("input", function() {

    const userEmail = this.value;
    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!emailPattern.test(userEmail)) {
      document.querySelector("#userEmailCheckMsg").textContent = "올바른 이메일 형식으로 작성해주세요";
      return;
    }

    fetch(`/member/checkUserEmail?userEmail=${encodeURIComponent(userEmail)}`)
            .then(res => res.json())
            .then(exists => {
              if (exists) {
                document.querySelector("#userEmailCheckMsg").textContent = "이미 사용중인 이메일입니다.";
              } else {
                document.querySelector("#userEmailCheckMsg").textContent = "";
              }
            })
            .catch(error => {
              console.error(error);
              document.querySelector("#userEmailCheckMsg").textContent = "확인 중 오류 발생";
            });
  });
  const pw = document.querySelector("#userPW");
  const pwCheck = document.querySelector("#userPWCheck");
  const signupBtn = document.querySelector("#signupBtn");

  const pwCheckMsg = document.createElement("div");
  pwCheckMsg.classList.add("mt-1");
  pwCheck.insertAdjacentElement("afterend", pwCheckMsg);

  signupBtn.disabled = true;

  function validatePassword() {
    if (pw.value.length === 0 || pwCheck.value.length === 0) {
      pwCheckMsg.textContent = "";
      signupBtn.disabled = true;
      return;
    }
    if (pw.value !== pwCheck.value) {
      pwCheckMsg.textContent = "비밀번호가 일치하지 않습니다.";
      pwCheckMsg.style.color = "red";
      signupBtn.disabled = true;
    } else {
      pwCheckMsg.textContent = "비밀번호가 일치합니다.";
      pwCheckMsg.style.color = "green";
      signupBtn.disabled = false;
    }
  }
  pw.addEventListener("input", validatePassword);
  pwCheck.addEventListener("input", validatePassword);
</script>
